"use strict";
(self["webpackChunk_mixly_python_pyodide"] = self["webpackChunk_mixly_python_pyodide"] || []).push([["node_modules_basthon_kernel-python3_lib_index_js"],{

/***/ "./node_modules/@basthon/kernel-base/lib/index.js":
/*!********************************************************!*\
  !*** ./node_modules/@basthon/kernel-base/lib/index.js ***!
  \********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   KernelBase: () => (/* reexport safe */ _kernel__WEBPACK_IMPORTED_MODULE_0__.KernelBase),
/* harmony export */   VERSION: () => (/* reexport safe */ _kernel__WEBPACK_IMPORTED_MODULE_0__.VERSION)
/* harmony export */ });
/* harmony import */ var _kernel__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./kernel */ "./node_modules/@basthon/kernel-base/lib/kernel.js");



/***/ }),

/***/ "./node_modules/@basthon/kernel-python3/lib/index.js":
/*!***********************************************************!*\
  !*** ./node_modules/@basthon/kernel-python3/lib/index.js ***!
  \***********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   Python3Kernel: () => (/* reexport safe */ _kernel__WEBPACK_IMPORTED_MODULE_0__.Python3Kernel)
/* harmony export */ });
/* harmony import */ var _kernel__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./kernel */ "./node_modules/@basthon/kernel-python3/lib/kernel.js");



/***/ }),

/***/ "./node_modules/@basthon/kernel-python3/lib/kernel.js":
/*!************************************************************!*\
  !*** ./node_modules/@basthon/kernel-python3/lib/kernel.js ***!
  \************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   Python3Kernel: () => (/* binding */ Python3Kernel)
/* harmony export */ });
/* harmony import */ var _basthon_kernel_base__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @basthon/kernel-base */ "./node_modules/@basthon/kernel-base/lib/index.js");

const PYODIDE_VERSION = "0.23.2";
/**
 * A Python kernel that satisfies Basthon's API.
 */
class Python3Kernel extends _basthon_kernel_base__WEBPACK_IMPORTED_MODULE_0__.KernelBase {
    constructor(options) {
        super(options);
        /**
         * Where to find pyodide.js (private).
         */
        this._pyodideURLs = [
            `https://cdn.jsdelivr.net/pyodide/v{PYODIDE_VERSION}/full/pyodide.js`,
        ];
        this.__kernel__ = null;
        this.pythonVersion = "";
        // for locally installed Pyodide
        this._pyodideURLs.unshift(`${this.basthonRoot()}/pyodide/pyodide.js`);
        this._pyodideURLs = options?.pyodideURLs ?? this._pyodideURLs;
    }
    /**
     * Get the URL of Basthon modules dir.
     */
    basthonModulesRoot(absolute = false) {
        return this.basthonRoot(absolute) + "/modules";
    }
    language() {
        return "python3";
    }
    languageName() {
        return "Python 3";
    }
    moduleExts() {
        return ["py"];
    }
    /**
     * What to do when loaded (private).
     */
    async _onload() {
        const pyodide = window.pyodide;
        // reformat repodata
        const packages = pyodide._api.repodata_packages;
        for (let p of Object.keys(packages)) {
            const item = packages[p];
            item.file_name = item.file_name.replace("{basthonRoot}", this.basthonRoot(true));
        }
        // get the version of Python from Python
        this.pythonVersion = pyodide.runPython("import platform ; platform.python_version()");
        // load basthon and get kernel
        await pyodide.loadPackage("basthon");
        this.__kernel__ = pyodide.pyimport("basthon").__kernel__;
    }
    /**
     * Start the Basthon kernel asynchronously.
     */
    async _init() {
        await super._init();
        let pyodideURL = this._pyodideURLs[0];
        for (let url of this._pyodideURLs) {
            url = url.replace("{PYODIDE_VERSION}", PYODIDE_VERSION);
            try {
                const response = await fetch(url, { method: "HEAD" });
                if (response.ok) {
                    pyodideURL = url;
                    break;
                }
            }
            catch (e) { }
        }
        try {
            await Python3Kernel.loadScript(pyodideURL);
        }
        catch (error) {
            console.log(error);
            console.error("Can't load pyodide.js");
            throw error;
        }
        if (window.loadPyodide == null) {
            console.log("window.loadPyodide is null!");
            throw new Error("Can't load pyodide.js");
        }
        try {
            // loading with custom repodata.json
            window.pyodide = await window.loadPyodide({
                lockFileURL: this.basthonRoot() + "/repodata.json",
            });
        }
        catch (error) {
            console.log(error);
            console.error("Can't load Python from Pyodide");
            throw error;
        }
        await this._onload();
    }
    /**
     * Execution count getter overload.
     */
    get execution_count() {
        return this.__kernel__.execution_count();
    }
    /**
     * Basthon async code evaluation function.
     */
    async evalAsync(code, outCallback, errCallback, data = null) {
        if (typeof outCallback === "undefined") {
            outCallback = function (text) {
                console.log(text);
            };
        }
        if (typeof errCallback === "undefined") {
            errCallback = function (text) {
                console.error(text);
            };
        }
        // dependencies are loaded by eval
        const proxy = await this.__kernel__.eval(code, outCallback, errCallback, data);
        // when an error occures, proxy should be the error message
        if (!(proxy instanceof window.pyodide.ffi.PyProxy))
            throw proxy;
        const res = proxy.toJs({
            create_proxies: false,
            dict_converter: Object.fromEntries,
        });
        proxy.destroy();
        return res;
    }
    /**
     * Start the kernel.
     */
    async _start() {
        await super._start();
        this.__kernel__.start();
    }
    /**
     * Stop the kernel.
     */
    async _stop() {
        this.__kernel__.stop();
        await super._stop();
    }
    /**
     * Put a file on the local (emulated) filesystem.
     */
    async putFile(filename, content) {
        this.__kernel__.put_file(filename, content);
    }
    /**
     * Put an importable module on the local (emulated) filesystem
     * and load dependencies.
     */
    async putModule(filename, content) {
        return await this.__kernel__.put_module(filename, content);
    }
    /**
     * List modules launched via putModule.
     */
    userModules() {
        const proxy = this.__kernel__.user_modules();
        if (!(proxy instanceof window.pyodide.ffi.PyProxy))
            return proxy;
        const res = proxy.toJs();
        proxy.destroy();
        return res;
    }
    /**
     * Get a file content from the VFS.
     */
    getFile(path) {
        return this.__kernel__.get_file(path).toJs();
    }
    /**
     * Get a user module file content.
     */
    getUserModuleFile(filename) {
        return this.__kernel__.get_user_module_file(filename).toJs();
    }
    /**
     * Is the source ready to be evaluated or want we more?
     * Usefull to set ps1/ps2 for teminal prompt.
     */
    async more(source) {
        return this.__kernel__.more(source);
    }
    /**
     * Mimic the CPython's REPL banner.
     */
    banner() {
        /* We don't return this.__kernel__.banner();
         * since the banner should be available ASAP.
         * In tests, we check this.banner() ===  this.__kernel__.banner().
         */
        return `Python 3.11.2 (main, May  3 2023 04:00:05) on WebAssembly/Emscripten\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.`;
    }
    /**
     * Complete a code at the end (usefull for tab completion).
     *
     * Returns an array of two elements: the list of completions
     * and the start index.
     */
    async complete(code) {
        const proxy = this.__kernel__.complete(code);
        if (!(proxy instanceof window.pyodide.ffi.PyProxy))
            return proxy;
        const res = proxy.toJs();
        proxy.destroy();
        return res;
    }
    /**
     * Change current directory (Python's virtual FS).
     */
    chdir(path) {
        window.pyodide._module.FS.chdir(path);
    }
    /**
     * Create directory (Python's virtual FS).
     */
    mkdir(path) {
        window.pyodide._module.FS.mkdir(path);
    }
}


/***/ })

}]);
//# sourceMappingURL=node_modules_basthon_kernel-python3_lib_index_js.bundle.js.map