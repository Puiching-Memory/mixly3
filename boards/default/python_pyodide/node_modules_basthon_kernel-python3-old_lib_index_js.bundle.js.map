{"version":3,"file":"node_modules_basthon_kernel-python3-old_lib_index_js.bundle.js","mappings":";;;;;;;;;;;;;;;AAAyB;;;;;;;;;;;;;;;;ACAA;;;;;;;;;;;;;;;;ACAyB;AAClD;AACA;AACA;AACA;AACO,+BAA+B,4DAAU;AAChD;AACA;AACA;AACA;AACA;AACA;AACA,gDAAgD,gBAAgB;AAChE;AACA;AACA;AACA;AACA,qCAAqC,mBAAmB;AACxD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kEAAkE;AAClE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gCAAgC,gBAAgB;AAChD;AACA,oDAAoD,gBAAgB;AACpE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://@mixly/python-pyodide/./node_modules/@basthon/kernel-base/lib/index.js","webpack://@mixly/python-pyodide/./node_modules/@basthon/kernel-python3-old/lib/index.js","webpack://@mixly/python-pyodide/./node_modules/@basthon/kernel-python3-old/lib/kernel.js"],"sourcesContent":["export * from \"./kernel\";\n","export * from \"./kernel\";\n","import { KernelBase } from \"@basthon/kernel-base\";\nconst PYODIDE_VERSION = \"0.16.1\";\n/**\n * A Python kernel that satisfies Basthon's API.\n */\nexport class Python3OldKernel extends KernelBase {\n    constructor(options) {\n        super(options);\n        /**\n         * Where to find pyodide.js (private).\n         */\n        this._pyodideURLs = [\n            `https://cdn.jsdelivr.net/pyodide/v{PYODIDE_VERSION}/full/pyodide.js`,\n        ];\n        this.__kernel__ = null;\n        this.pythonVersion = \"\";\n        // for locally installed Pyodide\n        this._pyodideURLs.unshift(`${this.basthonRoot()}/pyodide/pyodide.js`);\n        this._pyodideURLs = options?.pyodideURLs ?? this._pyodideURLs;\n    }\n    /**\n     * Get the URL of Basthon modules dir.\n     */\n    basthonModulesRoot(absolute = false) {\n        return this.basthonRoot(absolute) + \"/modules\";\n    }\n    language() {\n        return \"python3-old\";\n    }\n    languageName() {\n        return \"Python 3 Old\";\n    }\n    moduleExts() {\n        return [\"py\"];\n    }\n    /**\n     * What to do when loaded (private).\n     */\n    async _onload() {\n        const pyodide = window.pyodide;\n        // get the version of Python from Python\n        this.pythonVersion = pyodide.runPython(\"import platform ; platform.python_version()\");\n        // this is for avoiding \"Unknown package 'basthon'\" error\n        // but can be removed  with 0.17.0 since it is fixed upstream\n        const consoleErrorBck = console.error;\n        console.error = () => { };\n        await pyodide.loadPackage(this.basthonRoot(true) + \"/basthon.js\");\n        console.error = consoleErrorBck;\n        // importing basthon to get it's kernel\n        await pyodide.runPythonAsync(\"import basthon as __basthon__\");\n        // kernel lookup\n        this.__kernel__ = pyodide.globals.__basthon__.__kernel__;\n        // removing basthon from global namespace\n        await pyodide.runPythonAsync(\"del __basthon__\");\n    }\n    /**\n     * Start the Basthon kernel asynchronously.\n     */\n    async _init() {\n        await super._init();\n        let pyodideURL = this._pyodideURLs[0];\n        for (let url of this._pyodideURLs) {\n            url = url.replace(\"{PYODIDE_VERSION}\", PYODIDE_VERSION);\n            try {\n                const response = await fetch(url, { method: \"HEAD\" });\n                if (response.ok) {\n                    pyodideURL = url;\n                    break;\n                }\n            }\n            catch (e) { }\n        }\n        // forcing Pyodide to look at the right location for other files\n        window.languagePluginUrl =\n            pyodideURL.substr(0, pyodideURL.lastIndexOf(\"/\")) + \"/\";\n        try {\n            await Python3OldKernel.loadScript(pyodideURL);\n        }\n        catch (error) {\n            console.log(error);\n            console.error(\"Can't load pyodide.js\");\n            throw error;\n        }\n        if (window.languagePluginLoader == null) {\n            throw new Error(\"Can't load pyodide.js\");\n        }\n        await window.languagePluginLoader;\n        await this._onload();\n    }\n    /**\n     * Execution count getter overload.\n     */\n    get execution_count() {\n        return this.__kernel__.execution_count();\n    }\n    /**\n     * Basthon async code evaluation function.\n     */\n    async evalAsync(code, outCallback, errCallback, data = null) {\n        if (typeof outCallback === \"undefined\") {\n            outCallback = function (text) {\n                console.log(text);\n            };\n        }\n        if (typeof errCallback === \"undefined\") {\n            errCallback = function (text) {\n                console.error(text);\n            };\n        }\n        // loading dependencies are loaded by eval\n        return await this.__kernel__.eval(code, outCallback, errCallback, data);\n    }\n    /**\n     * Start the kernel.\n     */\n    async _start() {\n        await super._start();\n        return this.__kernel__.start();\n    }\n    /**\n     * Stop the kernel.\n     */\n    async _stop() {\n        this.__kernel__.stop();\n        await super._stop();\n    }\n    /**\n     * Put a file on the local (emulated) filesystem.\n     */\n    async putFile(filename, content) {\n        this.__kernel__.put_file(filename, content);\n    }\n    /**\n     * Put an importable module on the local (emulated) filesystem\n     * and load dependencies.\n     */\n    async putModule(filename, content) {\n        return this.__kernel__.put_module(filename, content);\n    }\n    /**\n     * List modules launched via putModule.\n     */\n    userModules() {\n        return this.__kernel__.user_modules();\n    }\n    /**\n     * Get a file content from the VFS.\n     */\n    getFile(path) {\n        return this.__kernel__.get_file(path);\n    }\n    /**\n     * Get a user module file content.\n     */\n    getUserModuleFile(filename) {\n        return this.__kernel__.get_user_module_file(filename);\n    }\n    /**\n     * Is the source ready to be evaluated or want we more?\n     * Usefull to set ps1/ps2 for teminal prompt.\n     */\n    async more(source) {\n        return this.__kernel__.more(source);\n    }\n    /**\n     * Mimic the CPython's REPL banner.\n     */\n    banner() {\n        /* We don't return this.__kernel__.banner();\n         * since the banner should be available ASAP.\n         * In tests, we check this.banner() ===  this.__kernel__.banner().\n         */\n        return `Python 3.8.2 (default, Dec 25 2020 21:20:57) on WebAssembly VM\\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.`;\n    }\n    /**\n     * Complete a code at the end (usefull for tab completion).\n     *\n     * Returns an array of two elements: the list of completions\n     * and the start index.\n     */\n    async complete(code) {\n        return this.__kernel__.complete(code);\n    }\n    /**\n     * Change current directory (Python's virtual FS).\n     */\n    chdir(path) {\n        window.pyodide._module.FS.chdir(path);\n    }\n    /**\n     * Create directory (Python's virtual FS).\n     */\n    mkdir(path) {\n        window.pyodide._module.FS.mkdir(path);\n    }\n}\n"],"names":[],"sourceRoot":""}